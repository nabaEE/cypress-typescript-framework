node {
  // Set environment variable
  env.CYPRESS_CACHE_FOLDER = "${env.WORKSPACE}/.cache/Cypress"

  stage('Clone GitHub repo') {
    git branch: 'main',
        url: 'https://github.com/nabaEE/cypress-typescript-framework.git',
        credentialsId: 'github-creds'
  }

  stage('Run Cypress Tests in Docker') {
    // Pull and use the Docker image for Cypress
    def cypressImage = docker.image('cypress/included:14.4.1')
    cypressImage.pull() // optional: to make sure itâ€™s up-to-date

    cypressImage.inside('-u root') {
      sh 'npm ci'
      sh 'npx cypress run'
    }
  }
}
