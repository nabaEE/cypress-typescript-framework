node {
  // Define environment variable (just like in Declarative)
  env.CYPRESS_CACHE_FOLDER = "${env.WORKSPACE}/.cache/Cypress"

  stage('Clone GitHub repo') {
    git branch: 'main',
        url: 'https://github.com/nabaEE/cypress-typescript-framework.git',
        credentialsId: 'github-creds'
  }

  stage('Run Tests in Cypress Container') {
    docker.image('cypress/included:14.4.1').inside('-u root') {
      // Install dependencies
      sh 'npm ci'

      // Run Cypress tests
      sh 'npx cypress run'
    }
  }
}
